name: Sync from Gitee

on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š12ç‚¹åŒæ­¥
    - cron: '0 12 * * *'
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘
    inputs:
      reason:
        description: 'æ‰‹åŠ¨åŒæ­¥åŸå› '
        required: false
        default: 'æ‰‹åŠ¨è§¦å‘åŒæ­¥'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub Repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Add Gitee Remote
        run: |
          git remote add gitee https://gitee.com/physics_Ag/python-mathematical-modeling.git
          git config user.name "GitHub Actions Bot"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Fetch and Merge from Gitee
        run: |
          git fetch gitee
          # å°è¯•åˆå¹¶ï¼Œå¦‚æœæœ‰å†²çªåˆ™é‡‡ç”¨Giteeçš„ç‰ˆæœ¬
          git merge --no-commit --no-ff gitee/master || true
          # å¦‚æœæœ‰å†²çªæ–‡ä»¶ï¼Œä½¿ç”¨giteeçš„ç‰ˆæœ¬
          git diff --name-only --diff-filter=U | while read file; do
            git checkout --theirs "$file"
            git add "$file"
          done || true
          # æäº¤æ›´æ”¹
          git commit -m "ğŸ”„ Sync from Gitee $(date +'%Y-%m-%d %H:%M:%S')" || echo "æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ›´æ”¹"

      - name: Push to GitHub
        run: git push origin master
